- name: Bootstrap Python for Ansible
  hosts: all
  become: true
  gather_facts: false

  vars:
    required_packages:
      - python3
      - python3-six
      - python3-apt

  tasks:
    - name: Check if python3 exists
      raw: command -v python3
      register: python_check
      ignore_errors: true

    - name: Check if python3-six exists
      raw: python3 -c "import six"
      register: six_check
      ignore_errors: true
      when: python_check.rc == 0

    - name: Bootstrap Python dependencies
      block:

        - name: Update apt cache
          raw: apt update -y

        - name: Install required Python packages
          raw: apt install -y {{ required_packages | join(' ') }}

      when: python_check.rc != 0 or six_check is not defined or six_check.rc != 0

      rescue:
        - name: Bootstrap failed
          debug:
            msg: >
              Python bootstrap failed.
              Please check apt repository, internet connectivity,
              or package availability on target host

      always:
        - name: Bootstrap finished
          debug:
            msg: "Python bootstrap process completed"
