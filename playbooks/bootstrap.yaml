- name: Bootstrap Python for Ansible (FIRST TIME ONLY)
  hosts: all
  become: true
  gather_facts: false

  tasks:
    - name: Disable Google Cloud repo temporarily (if exists)
      raw: |
        if [ -f /etc/apt/sources.list.d/google-cloud-sdk.list ]; then
          mv /etc/apt/sources.list.d/google-cloud-sdk.list \
             /etc/apt/sources.list.d/google-cloud-sdk.list.disabled
        fi

    - name: Update apt cache (non-interactive)
      raw: |
        export DEBIAN_FRONTEND=noninteractive
        apt-get update -y

    - name: Install Python dependencies
      raw: |
        export DEBIAN_FRONTEND=noninteractive
        apt-get install -y \
          python3 \
          python3-apt \
          python3-six

    - name: Re-enable Google Cloud repo
      raw: |
        if [ -f /etc/apt/sources.list.d/google-cloud-sdk.list.disabled ]; then
          mv /etc/apt/sources.list.d/google-cloud-sdk.list.disabled \
             /etc/apt/sources.list.d/google-cloud-sdk.list
        fi
